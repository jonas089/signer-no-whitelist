{"ast":null,"code":"import _regeneratorRuntime from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _initializerDefineProperty from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";import _classCallCheck from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _applyDecoratedDescriptor from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";import _initializerWarningHelper from\"/home/chef/Desktop/signer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";var _class,_class2,_descriptor;import{observer}from'mobx-react';import React from'react';import{withRouter}from'react-router';import{observable}from'mobx';import{CreateAccountFormData,ImportAccountFormData}from'../container/ImportAccountContainer';import{Button,createStyles,Typography,FormControl,Box,InputLabel}from'@material-ui/core';import{SelectFieldWithFormState,TextFieldWithFormState}from'./Forms';import withStyles from'@material-ui/core/styles/withStyles';import Pages from'./Pages';import{confirm}from'./Confirmation';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var method;(function(method){method[method[\"Created\"]=0]=\"Created\";method[method[\"Imported\"]=1]=\"Imported\";})(method||(method={}));var styles=function styles(theme){return createStyles({root:{'& .MuiTextField-root':{marginTop:theme.spacing(2)}},importButton:{marginTop:theme.spacing(8)}});};var AccountPage=observer(_class=(_class2=/*#__PURE__*/function(_React$Component){_inherits(AccountPage,_React$Component);var _super=_createSuper(AccountPage);function AccountPage(props){var _this;_classCallCheck(this,AccountPage);_this=_super.call(this,props);_initializerDefineProperty(_this,\"accountForm\",_descriptor,_assertThisInitialized(_this));if(props.action==='Import'){_this.accountForm=new ImportAccountFormData(props.errors);}else{_this.accountForm=new CreateAccountFormData(props.errors);}_this.state={keyDownloadEnabled:false,algoAnchorEl:null,revealSecretKey:false};return _this;}_createClass(AccountPage,[{key:\"onCreateAccount\",value:function(){var _onCreateAccount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var formData,names;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formData=this.accountForm;if(!formData.submitDisabled){_context.next=3;break;}return _context.abrupt(\"return\");case 3:names=this.props.accountManager.userAccounts.map(function(account){return account.alias;});if(!names.includes(formData.name.$)){_context.next=6;break;}return _context.abrupt(\"return\",this.props.errors.capture(Promise.reject(new Error(\"An account with name '\".concat(formData.name.$,\"' already exists.\")))));case 6:_context.next=8;return this._onSubmit(method.Created);case 8:this.downloadKeys(formData.name.$);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function onCreateAccount(){return _onCreateAccount.apply(this,arguments);}return onCreateAccount;}()},{key:\"downloadKeys\",value:function downloadKeys(alias){var _this2=this;confirm(/*#__PURE__*/_jsx(\"div\",{className:\"text-danger\",children:\"Download your key\"}),'To proceed, download and save your key securely. Without it, you will not be able to recover access to your account.','Download','Cancel').then(/*#__PURE__*/ // OK\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _this2.props.accountManager.downloadPemFiles(alias);case 3:_context2.next=8;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",_this2.props.errors.capture(Promise.reject(new Error('Failed to download keys'))));case 8:case\"end\":return _context2.stop();}}},_callee2,null,[[0,5]]);})),/*#__PURE__*/ // CANCEL\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return _this2.props.accountManager.removeUserAccount(alias);case 3:if(!(_this2.props.connectionContainer.connectionRequested&&!_this2.props.accountManager.userAccounts.length)){_context3.next=6;break;}_context3.next=6;return _this2.props.connectionContainer.resetConnectionRequest();case 6:_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",_this2.props.errors.capture(Promise.reject(new Error(\"Failed to delete keypair: \".concat(alias)))));case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);})));}},{key:\"onImportAccount\",value:function onImportAccount(){if(this.accountForm.submitDisabled){return;}this._onSubmit(method.Imported);}},{key:\"_onSubmit\",value:function(){var _onSubmit2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(source){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.props.accountManager.importUserAccount(this.accountForm.name.$,this.accountForm.secretKeyBase64.value,this.accountForm.algorithm.$,source===method.Created?false:true);case 2:this.props.history.push(Pages.Home);this.props.history.replace(Pages.Home);case 4:case\"end\":return _context4.stop();}}},_callee4,this);}));function _onSubmit(_x){return _onSubmit2.apply(this,arguments);}return _onSubmit;}()},{key:\"renderImportForm\",value:function renderImportForm(){var _this3=this;var form=this.accountForm;return/*#__PURE__*/_jsxs(\"form\",{className:this.props.classes.root,children:[/*#__PURE__*/_jsx(Typography,{id:\"continuous-slider\",variant:\"h6\",gutterBottom:true,children:\"Import from Secret Key File\"}),/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsxs(Box,{display:'flex',flexDirection:'row',alignItems:'center',m:1,children:[/*#__PURE__*/_jsxs(Button,{id:'private-key-uploader',variant:\"contained\",style:{backgroundColor:'var(--cspr-dark-blue)',color:'white'},component:\"label\",children:[\"Upload\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:'none'},onChange:function onChange(e){return form.handleFileSelect(e);}})]}),/*#__PURE__*/_jsx(Box,{ml:1,children:/*#__PURE__*/_jsx(Typography,{component:'span',children:/*#__PURE__*/_jsx(Box,{fontSize:12,children:form.file?form.file.name:'No file selected'})})})]})}),/*#__PURE__*/_jsx(TextFieldWithFormState,{fullWidth:true,label:\"Name imported account\",placeholder:\"Human Readable Alias\",id:\"import-name\",fieldState:this.accountForm.name}),/*#__PURE__*/_jsx(FormControl,{fullWidth:true,className:this.props.classes.importButton,children:/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:this.accountForm.submitDisabled,color:\"primary\",variant:'contained',onClick:function onClick(){_this3.onImportAccount();},children:\"Import\"})})]});}},{key:\"renderCreateForm\",value:function renderCreateForm(){var _this4=this;var formData=this.accountForm;return/*#__PURE__*/_jsxs(\"form\",{className:this.props.classes.root,onSubmit:function onSubmit(e){e.preventDefault();},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",style:{marginTop:'-1em'},children:\"Create Account\"}),/*#__PURE__*/_jsx(TextFieldWithFormState,{\"aria-label\":\"Input for setting name of key\",autoFocus:true,fullWidth:true,label:\"Name\",placeholder:\"Human Readable Alias\",id:\"import-name\",fieldState:this.accountForm.name}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"algo-select-lbl\",children:\"Algorithm\"}),/*#__PURE__*/_jsx(SelectFieldWithFormState,{fullWidth:true,labelId:\"algo-select-lbl\",fieldState:this.accountForm.algorithm,selectItems:[{value:'ed25519',text:'ED25519'},{value:'secp256k1',text:'SECP256k1'}]})]}),/*#__PURE__*/_jsx(TextFieldWithFormState,{fullWidth:true,InputProps:{readOnly:true,disabled:true},label:\"Public Key\",id:\"create-public-key\",value:formData.publicKey.$?formData.publicKey.$:''}),/*#__PURE__*/_jsx(FormControl,{fullWidth:true,margin:'normal',children:/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"mt-5\",disabled:this.accountForm.submitDisabled,color:\"primary\",variant:\"contained\",onClick:function onClick(){_this4.onCreateAccount();},children:\"Create\"})})]});}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"mt-5 mb-4\",children:this.accountForm instanceof CreateAccountFormData?this.renderCreateForm():this.renderImportForm()})});}}]);return AccountPage;}(React.Component),(_descriptor=_applyDecoratedDescriptor(_class2.prototype,\"accountForm\",[observable],{configurable:true,enumerable:true,writable:true,initializer:null})),_class2))||_class;export default withStyles(styles,{withTheme:true})(withRouter(AccountPage));","map":{"version":3,"sources":["/home/chef/Desktop/signer/src/popup/components/AccountPage.tsx"],"names":["observer","React","withRouter","observable","CreateAccountFormData","ImportAccountFormData","Button","createStyles","Typography","FormControl","Box","InputLabel","SelectFieldWithFormState","TextFieldWithFormState","withStyles","Pages","confirm","method","styles","theme","root","marginTop","spacing","importButton","AccountPage","props","action","accountForm","errors","state","keyDownloadEnabled","algoAnchorEl","revealSecretKey","formData","submitDisabled","names","accountManager","userAccounts","map","account","alias","includes","name","$","capture","Promise","reject","Error","_onSubmit","Created","downloadKeys","then","downloadPemFiles","removeUserAccount","connectionContainer","connectionRequested","length","resetConnectionRequest","Imported","source","importUserAccount","secretKeyBase64","value","algorithm","history","push","Home","replace","form","classes","backgroundColor","color","display","e","handleFileSelect","file","onImportAccount","preventDefault","text","readOnly","disabled","publicKey","onCreateAccount","renderCreateForm","renderImportForm","Component","withTheme"],"mappings":"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","sourcesContent":["import { observer } from 'mobx-react';\nimport React from 'react';\nimport AccountManager from '../container/AccountManager';\nimport { RouteComponentProps, withRouter } from 'react-router';\nimport { observable } from 'mobx';\nimport {\n  CreateAccountFormData,\n  ImportAccountFormData\n} from '../container/ImportAccountContainer';\nimport ErrorContainer from '../container/ErrorContainer';\nimport {\n  Button,\n  createStyles,\n  Theme,\n  Typography,\n  WithStyles,\n  FormControl,\n  Box,\n  InputLabel\n} from '@material-ui/core';\nimport { SelectFieldWithFormState, TextFieldWithFormState } from './Forms';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport Pages from './Pages';\nimport { confirm } from './Confirmation';\nimport ConnectSignerContainer from '../container/ConnectSignerContainer';\n\nenum method {\n  'Created',\n  'Imported'\n}\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    root: {\n      '& .MuiTextField-root': {\n        marginTop: theme.spacing(2)\n      }\n    },\n    importButton: {\n      marginTop: theme.spacing(8)\n    }\n  });\n\ninterface Props extends RouteComponentProps, WithStyles<typeof styles> {\n  accountManager: AccountManager;\n  errors: ErrorContainer;\n  action: 'Import' | 'Create';\n  connectionContainer: ConnectSignerContainer;\n}\n\ninterface State {\n  keyDownloadEnabled: boolean;\n  algoAnchorEl: HTMLButtonElement | null;\n  revealSecretKey: boolean;\n}\n\n@observer\nclass AccountPage extends React.Component<Props, State> {\n  @observable accountForm: ImportAccountFormData | CreateAccountFormData;\n\n  constructor(props: Props) {\n    super(props);\n    if (props.action === 'Import') {\n      this.accountForm = new ImportAccountFormData(props.errors);\n    } else {\n      this.accountForm = new CreateAccountFormData(props.errors);\n    }\n    this.state = {\n      keyDownloadEnabled: false,\n      algoAnchorEl: null,\n      revealSecretKey: false\n    };\n  }\n\n  async onCreateAccount() {\n    const formData = this.accountForm as CreateAccountFormData;\n    if (formData.submitDisabled) {\n      return;\n    }\n\n    const names = this.props.accountManager.userAccounts.map(\n      account => account.alias\n    );\n    if (names.includes(formData.name.$)) {\n      return this.props.errors.capture(\n        Promise.reject(\n          new Error(`An account with name '${formData.name.$}' already exists.`)\n        )\n      );\n    }\n\n    await this._onSubmit(method.Created);\n    this.downloadKeys(formData.name.$);\n  }\n\n  downloadKeys(alias: string) {\n    confirm(\n      <div className=\"text-danger\">Download your key</div>,\n      'To proceed, download and save your key securely. Without it, you will not be able to recover access to your account.',\n      'Download',\n      'Cancel'\n    ).then(\n      // OK\n      async () => {\n        try {\n          await this.props.accountManager.downloadPemFiles(alias);\n        } catch (error) {\n          return this.props.errors.capture(\n            Promise.reject(new Error('Failed to download keys'))\n          );\n        }\n      },\n      // CANCEL\n      async () => {\n        try {\n          await this.props.accountManager.removeUserAccount(alias);\n          if (\n            this.props.connectionContainer.connectionRequested &&\n            !this.props.accountManager.userAccounts.length\n          ) {\n            await this.props.connectionContainer.resetConnectionRequest();\n          }\n        } catch (error) {\n          return this.props.errors.capture(\n            Promise.reject(new Error(`Failed to delete keypair: ${alias}`))\n          );\n        }\n      }\n    );\n  }\n\n  onImportAccount() {\n    if (this.accountForm.submitDisabled) {\n      return;\n    }\n    this._onSubmit(method.Imported);\n  }\n\n  async _onSubmit(source: method) {\n    await this.props.accountManager.importUserAccount(\n      this.accountForm.name.$,\n      this.accountForm.secretKeyBase64.value,\n      this.accountForm.algorithm.$,\n      source === method.Created ? false : true\n    );\n    this.props.history.push(Pages.Home);\n    this.props.history.replace(Pages.Home);\n  }\n\n  renderImportForm() {\n    const form = this.accountForm as ImportAccountFormData;\n    return (\n      <form className={this.props.classes.root}>\n        <Typography id=\"continuous-slider\" variant=\"h6\" gutterBottom>\n          Import from Secret Key File\n        </Typography>\n        <FormControl>\n          <Box\n            display={'flex'}\n            flexDirection={'row'}\n            alignItems={'center'}\n            m={1}\n          >\n            <Button\n              id={'private-key-uploader'}\n              variant=\"contained\"\n              style={{\n                backgroundColor: 'var(--cspr-dark-blue)',\n                color: 'white'\n              }}\n              component=\"label\"\n            >\n              Upload\n              <input\n                type=\"file\"\n                style={{ display: 'none' }}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  form.handleFileSelect(e)\n                }\n              />\n            </Button>\n            <Box ml={1}>\n              <Typography component={'span'}>\n                <Box fontSize={12}>\n                  {form.file ? form.file.name : 'No file selected'}\n                </Box>\n              </Typography>\n            </Box>\n          </Box>\n        </FormControl>\n        <TextFieldWithFormState\n          fullWidth\n          label=\"Name imported account\"\n          placeholder=\"Human Readable Alias\"\n          id=\"import-name\"\n          fieldState={this.accountForm.name}\n        />\n        <FormControl fullWidth className={this.props.classes.importButton}>\n          <Button\n            type=\"submit\"\n            disabled={this.accountForm.submitDisabled}\n            color=\"primary\"\n            variant={'contained'}\n            onClick={() => {\n              this.onImportAccount();\n            }}\n          >\n            Import\n          </Button>\n        </FormControl>\n      </form>\n    );\n  }\n\n  renderCreateForm() {\n    const formData = this.accountForm as CreateAccountFormData;\n    return (\n      <form\n        className={this.props.classes.root}\n        onSubmit={e => {\n          e.preventDefault();\n        }}\n      >\n        <Typography variant=\"h6\" style={{ marginTop: '-1em' }}>\n          Create Account\n        </Typography>\n        <TextFieldWithFormState\n          aria-label=\"Input for setting name of key\"\n          autoFocus\n          fullWidth\n          label=\"Name\"\n          placeholder=\"Human Readable Alias\"\n          id=\"import-name\"\n          fieldState={this.accountForm.name}\n        />\n        <FormControl fullWidth>\n          <InputLabel id=\"algo-select-lbl\">Algorithm</InputLabel>\n          <SelectFieldWithFormState\n            fullWidth\n            labelId=\"algo-select-lbl\"\n            fieldState={this.accountForm.algorithm}\n            selectItems={[\n              { value: 'ed25519', text: 'ED25519' },\n              { value: 'secp256k1', text: 'SECP256k1' }\n            ]}\n          />\n        </FormControl>\n        <TextFieldWithFormState\n          fullWidth\n          InputProps={{ readOnly: true, disabled: true }}\n          label=\"Public Key\"\n          id=\"create-public-key\"\n          value={formData.publicKey.$ ? formData.publicKey.$ : ''}\n        />\n        <FormControl fullWidth margin={'normal'}>\n          <Button\n            type=\"submit\"\n            className=\"mt-5\"\n            disabled={this.accountForm.submitDisabled}\n            color=\"primary\"\n            variant=\"contained\"\n            onClick={() => {\n              this.onCreateAccount();\n            }}\n          >\n            Create\n          </Button>\n        </FormControl>\n      </form>\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"mt-5 mb-4\">\n          {this.accountForm instanceof CreateAccountFormData\n            ? this.renderCreateForm()\n            : this.renderImportForm()}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withStyles(styles, { withTheme: true })(withRouter(AccountPage));\n"]},"metadata":{},"sourceType":"module"}